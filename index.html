<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Job Data Relay</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            padding: 20px;
            max-width: 600px;
            margin: 0 auto;
        }
        .status {
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .loading { background: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <h2>LinkedIn Job Data Relay</h2>
    <div id="status" class="status loading">Waiting for job data...</div>
    <div id="details"></div>

<script>
const WEBHOOK = "https://stoic-logins.app.n8n.cloud/webhook-test/24f33c25-480c-4a17-9ddb-0d6557ea1922";

window.addEventListener("message", async (event) => {
    const { jobs, url } = event.data || {};
    
    if (!jobs || jobs.length === 0) {
        document.getElementById("status").className = "status error";
        document.getElementById("status").innerHTML = "<strong>Error:</strong> No job data received";
        return;
    }

    document.getElementById("status").className = "status loading";
    document.getElementById("status").innerHTML = `<strong>Processing:</strong> Found ${jobs.length} job(s)...`;
    
    document.getElementById("details").innerHTML = `
        <h3>Extracted Jobs:</h3>
        <ul>
            ${jobs.map(job => `<li><strong>${job.title}</strong> at ${job.company} (${job.location})</li>`).join('')}
        </ul>
    `;

    try {
        const response = await fetch(WEBHOOK, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ 
                sourceUrl: url,
                jobCount: jobs.length,
                jobs: jobs,
                timestamp: new Date().toISOString()
            })
        });

        if (response.ok) {
            document.getElementById("status").className = "status success";
            document.getElementById("status").innerHTML = `<strong>Success!</strong> Sent ${jobs.length} job(s) to webhook`;
        } else {
            throw new Error(`HTTP ${response.status}`);
        }
    } catch (e) {
        document.getElementById("status").className = "status error";
        document.getElementById("status").innerHTML = `<strong>Failed:</strong> ${e.message}`;
        console.error(e);
    }
}, false);
</script>
</body>
</html>
